---
title: "Kafka"
date: 2020-08-23T18:30:31+08:00
draft: true
---

kafka数据流处理，可以认为它是一个存数据的缓冲区，我们可以把一些字节打进去，然后有很多消费者来消费。你啥都不管，可以拼命高并发送数据进去，然后消费。消费的这些数据一般都是非结构化，或者可重复处理的数据。你可以重新读这些数据。
RabbitMQ，消息队列，和kafka有些功能类似，但功能更多，主要不是用来做中间缓冲的，一般用来做rpc通讯或者其他同步消息通讯。当然，你也可以用MQ来模拟kafka。

Kafka是LinkedIn开源的分布式发布-订阅消息系统，目前归属于Apache顶级项目。Kafka主要特点是基于Pull的模式来处理消息消费，`追求高吞吐量`，一开始的目的就是用于日志收集和传输。0.8版本开始支持复制，不支持事务，对消息的重复、丢失、错误没有严格要求，适合产生大量数据的互联网服务的数据收集业务。

RabbitMQ是使用Erlang语言开发的开源消息队列系统，基于AMQP（Advanced Message Queue）协议来实现。AMQP的主要特征是面向消息、队列、路由（包括点对点和发布/订阅）、可靠性、安全。AMQP协议更多用在企业系统内，`对数据一致性、稳定性和可靠性要求很高的场景`，对性能和吞吐量的要求还在其次。


# RPC
RPC（Remote Procedure Call）远程过程调用，主要解决远程通信间的问题，不需要了解底层网络的通信机制。
RPC的一般需要经历4个步骤：
1. 建立通信
    首先要解决通讯的问题：即A机器想要调用B机器，首先得建立起通信连接，主要是通过在客户端和服务器之间建立TCP连接。
2. 服务寻址
    要解决寻址的问题，A服务器上如何连接到B服务器（如主机或IP地址）以及特定的端口，方法的名称是什么。
3. 网络传输
    1. 序列化
        当A服务器上的应用发起一个RPC调用时，调用方法和参数数据都需要先进行序列化。
    2. 反序列化
        当B服务器接收到A服务器的请求之后，又需要对接收到的参数等信息进行反序列化操作。
4. 服务调用
    B服务器进行本地调用（通过代理Proxy）之后得到了返回值，此时还需要再把返回值发送回A服务器，同样也需要经过序列化操作，然后再经过网络传输将二进制数据发送回A服务器。

通常，一次完整的PRC调用需要经历如上4个步骤。

# RPC和MQ的区别和关联
1. 在架构上，RPC和MQ的差异点是，MQ有一个中间结点Message Queue，可以把消息存储，而RPC没有。
2. 同步调用：对于要立即等待返回处理结果的场景，RPC是首选。
3. MQ 的使用，一方面是基于性能的考虑，比如服务端不能快速的响应客户端（或客户端也不要求实时响应），需要在队列里缓存。另外一方面，它更侧重数据的传输，因此方式更加多样化，除了点对点外，还有订阅发布等功能。
4. 而且随着业务增长，有的处理端处理量会成为瓶颈，会进行同步调用改造为异步调用，这个时候可以考虑使用MQ。